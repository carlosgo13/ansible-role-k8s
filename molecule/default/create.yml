---
- name: create

  hosts: localhost

  gather_facts: false

  vars_files: ../vars/shared.yml

  pre_tasks:

    - name: show debug info
      debug:
        msg: >-
          using kind bin at {{ _kind_bin }}

  tasks:

    - name: list kind clusters
      ansible.builtin.command: >-
        {{ _kind_bin }} get clusters -q
      register: kind_cluster_query
      changed_when: false

    - name: deploy kind cluster
      ansible.builtin.shell: >-
        {{ _kind_bin }} get clusters | grep molecule ||
        {{ _kind_bin }} create cluster --name {{ _cluster_name }} --kubeconfig {{ _kubeconfig }}
      when: _cluster_name not in kind_cluster_query.stdout_lines
